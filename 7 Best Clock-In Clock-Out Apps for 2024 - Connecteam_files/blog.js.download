function detailsTransitionHelper () {
  const $detailsElements = document.querySelectorAll('details')
  if (!$detailsElements.length) return

  function setState ($details) {
    $details.style.setProperty('--height', $details.clientHeight.toString())
  }

  $detailsElements.forEach(/** @var HTMLDetailsElement */ $details => {
    setState($details)

    $details.addEventListener('toggle', () => {
      setState($details)
    })

    window.addEventListener('resize', () => {
      setState($details)
    })
  })
}

function authorTooltip () {
  document.addEventListener('DOMContentLoaded', () => {
    if (!window.tippy) return

    document.querySelectorAll('[data-tippy-template]').forEach($el => {
      const id = $el.getAttribute('data-tippy-template')
      window.tippy(`[data-tippy-template=${id}]`, {
        theme: 'ct',
        aria: {
          content: null,
          expanded: false,
        },
        interactive: true,
        placement: 'bottom-start',
        trigger: 'mouseenter',
        allowHTML: true,
        content () {
          return document.getElementById(id).innerHTML
        }
      })
    })
  })
}

function sideBannerVisibility () {
  const $sideBanner = document.querySelector('.sticky-side-banner')
  if (!$sideBanner.classList.contains('hidden')) return

  function setState () {
    $sideBanner.classList.toggle('hidden', window.scrollY < window.innerHeight)
  }

  window.addEventListener('scroll', setState)
  setState()
}

detailsTransitionHelper()
authorTooltip()
sideBannerVisibility()